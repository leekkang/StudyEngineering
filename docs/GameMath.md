
## GameMath
  - 게임에서 사용하는 수학 정보들 

  - 참고 블로그
    - https://wjs7347.tistory.com/17

---
# 좌표계 변환

  - 어떤 한 좌표계에서 일어나는 모든 움직임들은 `다른 좌표계`에서 보면 반대로 보인다.
    - `좌표계 내의 한 점`을 다른 좌표계로 이동시키는 것과, `좌표계` 자체를 이동시키는 것은 서로 반대다.
  - `좌표계` 의 이동은 `좌표계 단위 벡터`의 이동과 동일하다.
  - 어떤 한 좌표계를 다른 좌표계로 변환한다는 것은 `좌표계 단위 벡터`를 `다른 좌표계 단위 벡터`와 동일한 값으로 바꾼다는 말과 동일하다.
  - 이 때 `원래 좌표계`의 좌표들은 가만히 있지만, `좌표계`의 입장에서는 `상대적`으로 이동을 한 것처럼 보인다.
    - `원점`을 앞으로 이동시키면, `원래 좌표계에 있는 한 점`은 **원점에서 봤을 때 뒤로 간다.**
  - 결국 이동한 `원래 좌표계`는 `새로운 좌표계`가 되고, `원래 좌표계의 값`들은 좌표계 움직임의 반대로 이동한 것처럼 계산되어 `새로운 좌표`가 된다.

  - ### 위치 변환
    - 보통 같은 좌표계에서 이동할 때 해당 좌표를 더한다.
   
    - `좌표계 이동`은 상대적인 움직임이다.
    - 그러므로 `현재 좌표계`에서 `원하는 좌표계의 기준`을 빼주면 `좌표계` 변환이 된다.
    - `현재 좌표계 값` - `원하는 좌표계 원점`(현재 좌표계) = `원하는 좌표계 값`
    - `월드 좌표` - `카메라 위치`(월드 좌표계) = `카메라 좌표`(카메라 좌표계)
  
  - ### 회전 변환
    - 보통 `어떤 좌표`를 $\theta$ 만큼 회전시킬 때, **$\theta$ 회전 행렬 * 세로 좌표** 수식을 사용한다.
    
    - `좌표계 이동`은 상대적인 움직임이기 때문에 $-\theta$ 만큼 회전시키면 **$\theta$ 회전 변환이 된 좌표계** 내의 좌표값이 나온다.
    - **$\theta$ 회전 행렬 * 세로 좌표의 결과값** 과 **가로 좌표 * $-\theta$ 회전 행렬의 결과값** 은 동일하다.
    - `회전 변환`에서 `회전 행렬`을 좌표의 앞에 곱할 경우(행렬 * 세로 좌표), 해당 각도만큼 `좌표`가 회전이 되고, `회전 행렬`을 뒤에 곱할 경우(가로 좌표 * 행렬), 해당 각도만큼 `좌표계`가 회전이 된다.(좌표계 이동이 발생한다.)
      - `행렬 * 세로 좌표` : `좌표`가 이동. `좌표계`는 그대로 존재.
      - `가로 좌표 * 행렬` : `좌표계`가 이동. 좌표는 이동하지 않지만 새로운 값을 얻어 `새로운 좌표계`에서의 좌표를 나타내게 됨.
    - **보통 `좌표계`의 변환을 하는 경우가 많다.** `가로 좌표 * 행렬`의 식을 사용하거나, 회전 각도를 반대로 해서 `행렬 * 세로 좌표`의 식을 사용하면 된다.



---
# 두 선분의 교차점 구하기

  - 직선의 방정식을 `기울기`와 `절편`으로 나타내는 대신 매개변수를 이용하여 나타내면 깔끔하게 구할 수 있다. (벡터 방정식)
    - `P_1`과 `P_2` 사이를 `t : (1 - t)` 비율로 분리한 것과 같다.
  $$
  P(t) = (1 - t)P_1 + tP_2
  $$

  - 두 직선의 방정식을 매개변수 t, s 로 표현할 때, 2개의 식을 하나로 만들면 다음과 같다. 이 때, t와 s가 0~1 사이의 값을 가지지 않으면, **직선은 교차하지만 선분은 교차하지 않는 상태가 된다.**
  $$
  (1 - t)P_1 + tP_2 = (1 - s)P_1 + sP_2
  $$

  - x와 y로 분리하면 다음과 같다.
  $$
  x_1 + t(x_2 - x_1) = x_3 + s(x_4 - x_3) \\
  y_1 + t(y_2 - y_1) = y_3 + s(y_4 - y_3) 
  $$

  - t와 s로 정리하면 다음과 같다. (분모 같음)
  $$
  t = \frac{(x_4 - x_3)(y_1 - y_3) - (y_4 - y_3)(x_1 - x_3)} 
           {(y_4 - y_3)(x_2 - x_1) - (x_4 - x_3)(y_2 - y_1)} \\
  
  s = \frac{(x_2 - x_1)(y_1 - y_3) - (y_2 - y_1)(x_1 - x_3)} 
           {(y_4 - y_3)(x_2 - x_1) - (x_4 - x_3)(y_2 - y_1)} \\
  $$

  - t와 s는 두 선이 서로 만날때의 값이기 때문에, 최종적으로 두 선의 교점은 다음과 같다. 
  - `p - p1 : p2 - p = t : 1 - t` 닮음비를 이용한다.
  $$
  x = x_1 + t(x_2 - x_1) \\
  y = y_1 + t(y_2 - y_1) \\
  $$

  - 두 선분의 교차만 확인하고 싶은 경우 (게임에선 잘 없지만) `외적의 방향성`을 이용해서 쉽게 구분할 수 있다.
    - 선분의 한 점에서 시작하는 벡터를 기준으로 두 점까지의 벡터 외적값의 부호가 다르면 교차한다고 볼 수 있다.

      ![](img/cross.png)
   
    - 위의 그림처럼 $\overrightarrow{ab}$ 를 기준으로 `c`와 `d`의 외적값을 비교하고, $\overrightarrow{cd}$ 를 기준으로 `a`와 `b`의 외적값을 비교하면 된다.
  
  - TODO : [크라메르 공식 (Cramer's rule)](https://ko.wikipedia.org/wiki/%ED%81%AC%EB%9D%BC%EB%A9%94%EB%A5%B4_%EB%B2%95%EC%B9%99) 을 알아보자
  
  - 참고
    - [두 선의 교차점 구하기](http://www.gisdeveloper.co.kr/?p=89)
    - [두 선분의 교차여부 체크](https://crazyj.tistory.com/140?category=753578)
    - [2d 충돌 처리](https://netcanis.tistory.com/112)
    - [A Minimal Ray-Tracer](https://www.scratchapixel.com/lessons/3d-basic-rendering/minimal-ray-tracer-rendering-simple-shapes/ray-box-intersection)
    - [두 직선의 교점 구하기](https://wjs7347.tistory.com/17)
    - [외적을 이용해서 선분과 선분의 교차점 구하기](https://bowbowbow.tistory.com/17)